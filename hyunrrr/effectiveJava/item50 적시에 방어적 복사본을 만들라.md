# 이펙티브 자바
아이템50. 적시에 방어적 복사본을 만들라(p302-307)

### 생성자에서 받은 가변 매개변수 각각을 방어적으로 복사(defensive copy) 해라
- 여전히 많은 api와 내부 구현에 가변인 낡은 값 타입을 사용한다.
- 매개변수의 유효성을 검사(아이템49)하기 전에 방어적 복사본을 만들고, 이 복사본으로 유효성을 검사하자
- 매개변수가 제 3자에 의해 확장될 수 있는 타입이라면 방어적 복사본을 만들 때 clone을 사용하면 안 된다.
<br>(예를들어 악의적 사용자가 Date를 상속해 clone을 악의적으로 만들고, 이를 Date매개변수로 넘겨줄 수 있다.)

### 접근자(getter와 같은)가 가변 필드의 방어적 복사본을 반환하게 해라
- 생성자와 달리 접근자 메서드에서는 방어적 복사에 clone을 사용해도 된다. 그렇더라도 아이템 13에서 설명한 이유 때문에 생성자나 정적 팩터리를 쓰는게 좋다.
<br>(clone하려는 객체가 클래스 내부에 있으니 악의적인 하위 클래스 일 수 없다.)


### 변경될 수 있는 객체라도 임의로 변경되어도 추후 문제없이 동작할지를 따져봐라, 확신할 수 없으면 방어적 복사해라


### 방어적 복사는 성능 저하가 따르고, 항상 쓸 수 있는 것도 아니다.
- (같은 패키지에 속하는 등의 이유로)호출자가 컴포넌트 내부를 수정하지 않으리라 확신하면 방어적 복사를 생략할 수 있다.
<br>이런 상황이라면 호출자에서 해당 매개변수나 반환값을 수정하지 말아야 함을 명확히 문서화하는 게 좋다.
- (패키지가 다르더라도)때로는 메서드나 생성자의 매개변수로 넘기는 행위가 객체의 통제권을 이전함을 뜻하기도 한다. 이런 경우 통제권을 받은 클라이언트는 해당 객체를 직접 수정하지 않겠다 약속해야 한다.
<br>이런 통제권을 넘겨주는 메서드나 생성자에 대한 사실도 확실히 문서에 기재해야 한다.
- 방어적 복사를 생략할때, 불변식이 깨지더라도 그 영향이 오직 호출한 클라이언트로 국한될 때로 한정해야 한다.


## 핵심 정리
클래스가 클라이언트로부터 받는 혹은 클라이언트로 반환하는 구성요소가 가변이라면 그 요소는 반드시 방어적으로 복사해야 한다.
복사 비용이 너무 크거나 클라이언트가 그 요소를 잘못 수정할 일이 없음을 신뢰한다면 방어적 복사를 수행하는 대신 해당 구성요소를 수정했을 때의 책임이 클라이언트에 있음을 문서에 명시해라
