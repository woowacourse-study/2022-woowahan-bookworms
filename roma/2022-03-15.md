# 03.15 독서 인증

---
## 이것이 자바다 (834 - 849)

---


### 병렬 처리

- 병렬 스트림 생성법 → parallelStream() 메소드로 컬렉션으로부터 병렬 스트림을 바로 받음 / parallel() 메소드로 순차 처리 스트림을 병렬 처리 스트림으로 변환해서 리턴
- 내부적으로 전체 요소를 서브 요소들로 나누고, 이 서브요소들을 개별 스레드가 처리함
- 병렬성은 데이터 병렬성, 작업 병렬성이 있다.
    - 데이터 병렬성 : 전체 데이터를 쪼개서 서브 데이터들로 만들고 이 서브 데이터들을 병렬 처리해서 작업을 빨리 끝내는 것을 말함. 자바8에서 지원하는 병렬스트림이 데이터 병렬성을 구현한 예
    - 작업 병렬성 : 서로 다른 작업을 병렬 처리하는 것을 말함. 대표적인 예로 웹 서버. 웹 서버는 각각의 브라우저에서 요청한내용을 개별 쓰레드에서 병렬로 처리한다.
- 포크조인 프레임워크가 사용된다.
    - 워크 쓰레드의 수는 CPU 코어에 종속 ( 쿼드 코어면 쓰레드 4개 )
    - 포크 : 전체 데이터를 서브 데이터로 분리한 뒤  각 서브 데이터를 멀티 코어에서 병렬로 처리함
    - 조인 : 서브 결과를 결합해서 최종 결과를 만들어냄
    - ForkJoinPool : 작업하는 스레드를 관리하기 위한 스레드풀
- 병렬 스트림이 항상 순차 스트림보다 실행 성능이 좋다고 판단해서는 안됨. 다음 3가지 요인을 잘 살펴보라
    - 요소의 수와 요소당 처리 시간
        - 요소의 수가 적고 요소당 처리 시간이 짧으면 순차 처리가 오히려 병렬 처리보다 빠를 수 있다. 병렬 처리는 스레드풀 생성, 스레드 생성이라는 추가 비용이 발생하기 때문
    - 스트림 소스의 종류
        - ArrayList, 배열은 인덱스로 요소를 관리하기 때문에 포크 단계에서 요소를 쉽게 분리 가능해 병렬 처리 시간이 절약됨.
        - HashSet, TreeSet은 요소 분리가 쉽지않고 LinkedList 역시 링크를 따라가야 하므로 요소 분리가 쉽지 않음. 따라서 ArrayList, 배열 보다는 상대적으로 병렬 처리가 늦음
    - 코어의 수
        - 싱글코어 CPU의 경우 순차 처리가 빠르다. 병렬 스트림을 사용할 경우 스레드의 수만 증가하고 동시성 작업으로 처리되기 때문에 좋지 못한 결과를 준다. 코어의 수가 많으면많을수록 병렬 작업 속도는 빨라진다.