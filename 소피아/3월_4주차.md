# 03.21 독서 인증

## You Don't Know JS (p.219 ~ 232)

### Part 2. 스코프와 클로저

#### 3장 함수 vs 블록 스코프

#### 스코프 역할을 하는 함수

- **코드를 함수로 감싸 내부 변수나 내부 함수 선언문을 바깥 스코프로부터 숨길 수 있다. 하지만 외부 스코프에 해당 함수를 선언해야하고, 직접 호출해야 한다.** 이때 함수를 이름 없이 선언하고 자동으로 실행된다면 이상적일 것이다. **괄호로 함수를 감싸는 방법으로 이를 해결**할 수 있다.

  ```javascript
  (function foo() {
      ...
  })();
  ```

  이 코드에서 함수는 보통의 선언문이 아니라, 함수 표현식으로 취급된다. 'function'이 구문 시작 위치에 있다면 함수 선언문이고, 다른 경우는 함수 표현식이다.   함수 이름 foo는 함수를 둘러싼 스코프에 묶이는 대신, 함수 자신의 내부 스코프에 묶였다. 위 표현식에서 identifier foo는 오직 함수 내부 중괄호가 가리키는 스코프에서만 찾을 수 있고, 바깥 스코프에서는 발견되지 않는다. 함수 이름을 함수 자신의 내부에 숨겨, 함수를 둘러싼 스코프를 오염시키지 않는다.

- 함수 표현식은 몇 가지 기억할 단점이 있다.

  - 익명 함수는 스택 추적 시 표시할 이름이 없어서 디버깅이 더 어려울 수 있다.
  - 이름 없이 함수 스스로 재귀 호출을 하려면, 불행히고 arguments.callee 참조가 필요하다. 자기 참조가 필요한 또 다른 예로는 한 번 실행후 해제되는 이벤트 처리 함수가 있다.
  - 기능을 잘 나타내는 이름은 해당 코드를 그 자체로 설명하는 데 도움이 된다. 익명 함수는 이런 이름을 생략한다.

  익명이냐, 기명이냐의 문제가, 인라인 함수 표현식이 효과적이고 유용하다는 사실을 퇴색시키지는 않는다. 함수 표현식에 이름을 사용하면 앞의 단점을 해결할 수 있으므로, 함수 표현식에는 항상 이름을 쓰는 것이 좋다.

- 괄호로 감싸 표현식으로 만든 함수에, 바로 괄호를 붙여 실행시키는 패턴에, **즉시 호출 함수 표현식(IIFE, Immediately Invoked Function Expression)**이라는 용어를 사용하기도 한다. 앞서 언급했듯, IIFE를 기명으로 사용하면 익명으로 사용하는 것보다 더 나은 면이 있다. 함수를 감싼 괄호 밖에 호출에 사용되는 괄호()를 붙일 수도 있고, 호출에 사용되는 괄호도, 함수를 감싼 괄호 안으로 넣을 수도 있다.

#### 스코프 역할을 하는 블록

블록 스코프는 **변수를 최대한 사용처 가까이에서 최대한 작은 유효 범위를 갖도록 선언하는 목적**을 가진다. 개발자들은 의도하지 않게 변수가 원래 용도 이외의 곳에서 사용됐는지 점검하고 싶어한다. 변수가 혼란스럽고 유지 보수하기 어려운 방식으로 재사용되지 않아야 한다.

- **with**

  with는 지양해야 할 구조이지만, 블록 스코프의 한 형태로, with 문 내부의 객체는 바깥 스코프에 영향 주는 일 없이 with문이 끝날 때까지만 존재한다.

- **try/catch**

  ES3에서, try/catch 중 catch 부분에서 선언된 변수는 catch 블록 스코프에 속한다.

- **let**

  - ES6에서 키워드 let이 채택됐다. let은 선언된 변수를 둘러싼 블록의 스코프에 붙인다. 블록 스코프에 사용하는 블록을 명시적으로 생성하면, 어느 스코프에 속한 것인지 착각하기 쉬운 문제를 해결할 수 있다.예를 들어 if 문 내부에 명시적인 블록을 추가하면, if 문의 위치나 의미를 변화시키지 않고도 블록을 옮기기가 쉬워진다.

  - let은 호이스팅 효과를 받지 않는다. let으로 선언된 변수는 선언문 전에는 명백하게 존재하지 않는다.
  - 블록 스코프를 통해 자바스크립트 엔진에게 필요 없어 가비지 컬렉션 대상이 될 변수를 명료하게 알릴 수 있다.

- **const**

  - let과 마찬가지로 ES6에서 추가됐다. const 역시 블록 스코프를 생성하지만, 선언된 값은 상수로 고정된다.

블록 스코프가 var 함수 스코프를 완전히 대체할 수는 없다. 두 기능은 공존한다. 상황에 따라 더 읽기 쉽고 유지 보수 쉬운 코드 작성을 위해, **개발자는 함수 스코프와 블록 스코프 기술을 같이, 적절한 곳에 사용할 수 있어야 한다.**

<br />