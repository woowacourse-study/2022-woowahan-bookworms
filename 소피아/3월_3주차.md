# 03.14 독서 인증

## 모던 자바스크립트 Deep Dive (p.422 ~ 450)

### 24장. 클로저

#### 클로저란?

- 함수가 선언된 렉시컬 환경을 통해, 이미 실행이 종료된 함수에서 선언된 변수에도 접근할 수 있는 현상.
- 어떤 함수 내부에 중첩 함수가 정의되었을 때, 중첩 함수는 자신이 포함된 함수의 변수에 접근할 수 있는 현상.
- 외부 함수보다 중첩 함수가 더 오래 유지되는 경우, 중첩 함수는 외부 함수의 생존 여부(실행 컨텍스트의 생존 여부)와 상관없이, 상위 스코프를 참조할 수 있고, 상위 스코프의 식별자를 참조하고 그 값을 변경할 수도 있는 현상. (실행 컨텍스트의 소멸과 실행 컨텍스트의 렉시컬 환경이 소멸하는 시점이 다르다는 점에 주의하자.)

- 클로저는 중첩 함수가 상위 스코프의 식별자를 참조하고, 외부 함수보다 더 오래 유지되는 경우에 한정하는 것이 일반적이다.

  1. 중첩 함수가 외부 함수보다 더 오래 유지되지만, 상위 스코프의 어떤 식별자도 참조하지 않는다면 이는 클로저라고 할 수 없다.
     상위 스코프의 어떤 식별자도 참조하지 않는 경우, 대부분의 모던 브라우저는 최적화를 통해 상위 스코프를 기억하지 않는다.
  2. 중첩 함수가 외부 함수의 식별자를 참조하지만, 외부 함수 밖으로 중첩 함수가 반환되지 않아 중첩 함수의 생명주기가 더 짧다면, 생명 주기가 종료된 외부 함수의 식별자를 참조할 수 있는 현상이 나타나지 않으므로, 클로저라고 할 수 없다.

- 클로저에 의해 참조되는 상위 스코프의 변수를 자유 변수(free variable)이라고 부른다. 클로저라는 표현은 자유 변수에 함수가 묶여 있는(closed) 것을 의미한다.

#### 렉시컬 스코프

- 클로저가 나타나는 이유는, 자바스크립트가 함수 호출이 아닌 함수 정의 위치에 따라 상위 스코프를 결정하는 렉시컬 스코프(정적 스코프) 방식을 따르기 때문이다.
  함수가 정의된 위치와 호출되는 위치는 다를 수 있다. 렉시컬 스코프가 가능하려면, 함수는 자신의 정의된 환경인 상위 스코프를 기억해야 한다.
  함수 정의가 평가될때, 함수는 상위 스코프를 [[Environment]] 내부 슬롯에 저장한다. 따라서 함수는 자신이 존재하는 한 상위 스코프를 기억할 수 있게 된다.

- let이나 const 키워드를 사용하는 반복문은, 코드 블록을 반복 실행할 때마다 새로운 렉시컬 환경을 생성하여, 반복 당시의 상태를 스냅샷을 찍듯 저장한다. 반복문의 코드 블록 내부에서 함수를 정의하면, 정의된 함수의 상의 스코프는 이 스냅샷처럼 저장된 렉시컬 환경이 된다.

#### 클로저의 활용

클로저는 상태를 안전하게 변경하고 유지하기 위해 사용한다. 상태가 의도치 않게 변경되지 않도록 은닉하고, 특정 함수에게만 상태 변경을 허용한다.

<br />
