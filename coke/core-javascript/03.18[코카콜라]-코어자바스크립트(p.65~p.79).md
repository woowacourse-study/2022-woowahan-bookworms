## 코어자바스크립트(p.65~p.79)

- this

---

# 배운 점(Facts)

this는 실행 컨텍스트가 생성될 때 함께 결정된다. 즉, this는 함수를 호출할 때 결정된다고 할 수 있다.

## 전역 공간에서의 this

- 전역 공간에서의 this는 전역 객체를 가리킨다.
- 브라우저 환경에서 전역 객체는 window 이다.
- Node.js 환경에서는 global 이다.

```javascript
var a = 1;
console.log(a); // 1  // 변수 a에 접근 시 스코프 체인에서 a를 검색하다가 전역 스코프의 전역객체의 프로퍼티 a를 검색
console.log(window.a); // 1
console.log(this.a); // 1
```

자바스크립트이 모든 변수는 특정 객체의 프로퍼티로 동작을 한다. **즉 전역 변수를 선언하면 자바스크립트 엔진은 이를 전역객체의 프로퍼티로 할당한다.**

## 메서드로서 호출할 때 그 메서드 내부에서의 this

### 함수vs메서드

- 함수와 메서드는 독립성으로 차이를 구별한다.
- 함수는 그 자체로 독립적인 기능을 수행한다.
- 메서드는 자신을 호출한 대상 객체에 관한 동작을 수행한다.
- 함수: 변수에 담아 함수를 호출한 경우
- 메서드: 객체의 프로퍼티에 함수를 할당해서 호출한 경우

```javascript
var func = function (x) {
  console.log(x);
};

func(1); // Window {...}  1  // 함수

var obj = {
  method: func,
};

obj.method(2); // {method: f}  2 // 메서드
```

### 메서드 내부에서의 this

- this에는 호출한 주체에 대한 정보가 담긴다.
- 점 표기법의 경우 마지막 점 앞에 **명시된 객체**가 곧 this가 된다.
- obj.outer.inner.coke.method() -> coke 객체가 this가 된다.

```javascript
var obj = {
  outer: {
    inner: {
      coke: {
        method: function () {
          console.log(this);
          return this;
        },
      },
    },
  },
};

console.log(obj.outer.inner.coke === obj.outer.inner.coke.method()); // { method: [Function: method] }  true
```

### 함수 내부에서의 this

- 실행 컨텍스트를 활성화할 당시의 this가 지정되지 않으면 this는 전역 객체를 가리킨다.
- 따라서 함수의 this는 전역 객체를 가리킨다.

### 내부함수에서의 this를 우회하는 방법

```javascript
var obj = {
  outer: function () {
    console.log(this); // { outer: f } // obj

    var innerFunc1 = function () {
      console.log(this); // Window { ... } // window
    };
    innerFunc1();

    var self = this;
    var innerFunc2 = function () {
      console.log(self); // { outer: f } // obj
    };
    innerFunc2();
  },
};
obj.outer();
```

- var self = this; 로 할당을 해줘서 innerFunc2 함수의 this를 지정한다.
- 상위 스코프의 this를 저장해서 내부함수에서 활용하려는 방법이다.

## 화살표 함수, this를 바인딩 하지 않는 함수

- ES6에서 함수 내부에서 this가 전역객체를 바라보는 문제를 개선하기 위해 화살표 함수를 사용한다.
- 화살표 함수는 this를 바인딩 하지 않는다.

```javascript
var obj = {
  outer: function () {
    console.log(this); // { outer: f } // obj

    var innerFunc1 = function () {
      console.log(this); // Window { ... } // window
    };
    innerFunc1();

    var innerFunc2 = () => {
      console.log(this); // { outer: f } // obj
    };
    innerFunc2();
  },
};
obj.outer();
```

## 콜백함수

- 함수 A의 제어권을 다른 함수(또는 메서드) B에게 넘겨주는 경우 함수 A를 콜백함수라고 한다.
- this는 함수 B내부 로직에 정한 규칙에 따라 값이 결정된다.
- 콜백함수도 함수 이므로 기본적으로 this가 전역객체를 참조한다.

## 생성자 함수 내부에서의 this

- 생성자 함수는 어떤 공통된 성질을 지니는 객체들을 생성하는데 사용하는 함수 이다.
- 생성자를 클래스class, 클래스를 통해 만든 객체를 인스턴스instance 라고 한다.
- JS에서는 new 명령어와 함께 함수를 호출 하면 해당 함수가 생성자로서 동작하게 된다.
- 어떤 함수가 생성자 함수로서 호출된 경우 내부에서의 **this는 곧 새로 만들 구체적인 인스턴스 자신이 된다.**

---

# 회고(Feelings)

- 오늘 학습 말하기? 시간에 후이의 this 강의에 많은 영감을 받아 this를 공부하게 되었다.
- 더 나아가 코어 자바스크립트 this 부분을 공부한다.
- 지금까지 모호했던 this에 대해 알게 되었다.
- 나머지는 다음 시간에 읽어보도록 한다.
